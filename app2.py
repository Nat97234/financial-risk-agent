import streamlit as st
import pandas as pd
import requests
import yfinance as yf
from datetime import datetime

# ---------- ูุงุฌูุฉ ุงููุณุชุฎุฏู ----------
st.set_page_config(page_title="ุงููููู ุงูุฐูู ูููุตุญ ุงููุงูู", layout="wide")
st.title("๐ ูููู ุชูููู ุงููุฎุงุทุฑ ูุงููุตุญ ุงููุงูู ุงูุฐูู")
st.markdown("""
ูุฐุง ุงููุธุงู ูุณุชุฎุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุญููู ุงูุฃุณูู ูุชูุฏูู ูุตุงุฆุญ ูุงููุฉ ุฃูููุฉ.
ุฃุฏุฎู ุฑูุฒ ุงูุณูู (ูุซู `AAPL`, `TSLA`, `MSFT`) ููุญุตูู ุนูู ูุนูููุงุช ุชูุตูููุฉ.
""")

# ---------- ุฅุฏุฎุงู ุงููุณุชุฎุฏู ----------
symbol = st.text_input("ุฃุฏุฎู ุฑูุฒ ุงูุณูู:", value="AAPL")

# ---------- ุฌูุจ ุงูุจูุงูุงุช ูู yfinance ----------
def fetch_stock_info(symbol):
    try:
        stock = yf.Ticker(symbol)
        info = stock.info
        hist = stock.history(period="1mo")
        return info, hist
    except:
        return None, None

if symbol:
    info, hist = fetch_stock_info(symbol)
    if info:
        col1, col2 = st.columns(2)

        with col1:
            st.subheader(f"ูุนูููุงุช ุนู ุงูุณูู: {symbol.upper()}")
            st.write(f"**ุงูุณุนุฑ ุงูุญุงูู:** {info.get('currentPrice', 'N/A')} USD")
            st.write(f"**ุงููููุฉ ุงูุณูููุฉ:** {info.get('marketCap', 'N/A'):,} USD")
            st.write(f"**ุจูุชุง:** {info.get('beta', 'N/A')}")
            st.write(f"**ุงูุฃุฑุจุงุญ:** {info.get('dividendRate', 'N/A')} USD")
            st.write(f"**ูุชูุณุท ุงูุญุฌู:** {info.get('averageVolume', 'N/A'):,}")
            st.write(f"**ุชุบูุฑ ุงูุณูู ุงูููู:** {info.get('regularMarketChange', 0):.2f} USD")

        with col2:
            st.subheader("๐ ุงูุฑุณู ุงูุจูุงูู ููุณุนุฑ")
            st.line_chart(hist['Close'])

        # ---------- ุงูุชุญููู ----------
        st.markdown("---")
        st.subheader("๐ ุชุญููู ุฐูู ููุณูู:")

        current_price = info.get("currentPrice")
        beta = info.get("beta")
        market_cap = info.get("marketCap")
        volume = info.get("averageVolume")
        change = info.get("regularMarketChange")
        dividend = info.get("dividendRate")

        analysis = f"""
ููุง ูู ุงูุญุงู ูุน ุฃู ุงุณุชุซูุงุฑุ ููุงู ุฏุงุฆููุง ุฏุฑุฌุฉ ูู ุงููุฎุงุทุฑ ุงููุฑุชุจุทุฉ ุจุงูุงุณุชุซูุงุฑ ูู ุงูุฃุณููุ ุจูุง ูู ุฐูู ุณูู {symbol.upper()}.

- ุงูุณุนุฑ ุงูุญุงูู ููุณูู ูู **{current_price} ุฏููุงุฑูุง**.
- ูุชูุณุท ุญุฌู ุงูุชุฏุงูู ูู **{volume:,}**ุ ููุง ูุฏู ุนูู ูุดุงุท ุชุฏุงูู ุฌูุฏ.
- ูุนุฏู ุจูุชุง ูู **{beta}**ุ ููุง ูุนูู ุฃู ุงูุณูู {"ุฃูุซุฑ" if beta and beta > 1 else "ุฃูู"} ุญุณุงุณูุฉ ููุชุบูุฑุงุช ูู ุงูุณูู.
- ุงููููุฉ ุงูุณูููุฉ ููุดุฑูุฉ ูู **{market_cap:,} ุฏููุงุฑูุง**ุ ููุง ูุฌุนููุง {"ูุจูุฑุฉ" if market_cap and market_cap > 1e11 else "ูุชูุณุทุฉ"} ุงูุญุฌู.
- ุงูุฃุฑุจุงุญ ุงููุฏููุนุฉ ูู **{dividend if dividend else "ูุง ุชูุฌุฏ ุฃุฑุจุงุญ ูุฏููุนุฉ"}**.
- ุงูุชุบูุฑ ุงููููู ูู ุงูุณูู ูู **{change:.2f} ุฏููุงุฑูุง**.

โ๏ธ ูุฐุง ุงูุชุญููู ูุจุฏุฆู ููุง ููุนุชุจุฑ ูุตูุญุฉ ุงุณุชุซูุงุฑูุฉ. ููุฑุฌู ุงูุฑุฌูุน ููุตุงุฏุฑ ุฅุถุงููุฉ ูุจู ุงุชุฎุงุฐ ูุฑุงุฑ ูุงูู.
"""
        st.markdown(analysis)

        # ---------- ูุซุงู ุนูู ุณุคุงู ุฐูู ----------
        st.markdown("---")
        st.subheader("๐ง ูุซุงู ุนูู ุณุคุงู ูููู ุชุฌุฑุจุชู:")
        st.markdown("""
        ๐ ูุง ูู ุฃุจุฑุฒ ุนูุงูู ุงููุฎุงุทุฑ ูู ุณูู Apple ููู ูุนุชุจุฑ ุงุณุชุซูุงุฑูุง ุขูููุง ูู ุงููุถุน ุงูุญุงููุ
        
        ููููู ุทุฑุญ ุณุคุงูู ุจุตูุบุฉ ูุดุงุจูุฉ ูู ุงููุณุฎุฉ ุงููุชูุฏูุฉ ูู ุงููููู ุงูุฐูู ุจุงุณุชุฎุฏุงู ููุงุฐุฌ ูุบููุฉ ุฃูุจุฑ.
        """)
    else:
        st.error("โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ููุฐุง ุงูุฑูุฒ. ูุฑุฌู ุงูุชุฃูุฏ ูู ุตุญุชู.")